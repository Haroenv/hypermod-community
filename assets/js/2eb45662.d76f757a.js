"use strict";(self.webpackChunkcodeshift_community=self.webpackChunkcodeshift_community||[]).push([[353],{3905:function(e,n,o){o.d(n,{Zo:function(){return c},kt:function(){return m}});var t=o(7294);function a(e,n,o){return n in e?Object.defineProperty(e,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[n]=o,e}function r(e,n){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),o.push.apply(o,t)}return o}function i(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?r(Object(o),!0).forEach((function(n){a(e,n,o[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(o,n))}))}return e}function s(e,n){if(null==e)return{};var o,t,a=function(e,n){if(null==e)return{};var o,t,a={},r=Object.keys(e);for(t=0;t<r.length;t++)o=r[t],n.indexOf(o)>=0||(a[o]=e[o]);return a}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(t=0;t<r.length;t++)o=r[t],n.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}var p=t.createContext({}),l=function(e){var n=t.useContext(p),o=n;return e&&(o="function"==typeof e?e(n):i(i({},n),e)),o},c=function(e){var n=l(e.components);return t.createElement(p.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},u=t.forwardRef((function(e,n){var o=e.components,a=e.mdxType,r=e.originalType,p=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=l(o),m=a,f=u["".concat(p,".").concat(m)]||u[m]||d[m]||r;return o?t.createElement(f,i(i({ref:n},c),{},{components:o})):t.createElement(f,i({ref:n},c))}));function m(e,n){var o=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var r=o.length,i=new Array(r);i[0]=u;var s={};for(var p in n)hasOwnProperty.call(n,p)&&(s[p]=n[p]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var l=2;l<r;l++)i[l]=o[l];return t.createElement.apply(null,i)}return t.createElement.apply(null,o)}u.displayName="MDXCreateElement"},1895:function(e,n,o){o.r(n),o.d(n,{assets:function(){return c},contentTitle:function(){return p},default:function(){return m},frontMatter:function(){return s},metadata:function(){return l},toc:function(){return d}});var t=o(3117),a=o(102),r=(o(7294),o(3905)),i=["components"],s={id:"monorepos",title:"Integrating with monorepos",slug:"/monorepos"},p=void 0,l={unversionedId:"guides/monorepos",id:"guides/monorepos",title:"Integrating with monorepos",description:"Codeshift is specifically designed to play nicely with monorepos (AKA multi-package repositories, multi-project repositories, or monolithic repositories) such as Turborepo, Yarn, npm and pnpm workspaces and Lerna.",source:"@site/docs/guides/monorepos.mdx",sourceDirName:"guides",slug:"/monorepos",permalink:"/docs/monorepos",editUrl:"https://github.com/CodeshiftCommunity/CodeshiftCommunity/edit/main/website/docs/guides/monorepos.mdx",tags:[],version:"current",frontMatter:{id:"monorepos",title:"Integrating with monorepos",slug:"/monorepos"},sidebar:"docs",previous:{title:"CSS codemods via PostCSS",permalink:"/docs/css-codemods"},next:{title:"Import manipulation",permalink:"/docs/import-manipulation"}},c={},d=[{value:"Configuration",id:"configuration",level:2},{value:"Initializing",id:"initializing",level:2},{value:"Development",id:"development",level:2},{value:"Publising",id:"publising",level:2},{value:"Running",id:"running",level:2},{value:"Examples",id:"examples",level:2}],u={toc:d};function m(e){var n=e.components,o=(0,a.Z)(e,i);return(0,r.kt)("wrapper",(0,t.Z)({},u,o,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Codeshift is specifically designed to play nicely with monorepos (AKA multi-package repositories, multi-project repositories, or monolithic repositories) such as ",(0,r.kt)("a",{parentName:"p",href:"https://turborepo.org/"},"Turborepo"),", ",(0,r.kt)("a",{parentName:"p",href:"https://classic.yarnpkg.com/lang/en/docs/workspaces/"},"Yarn"),", ",(0,r.kt)("a",{parentName:"p",href:"https://docs.npmjs.com/cli/v7/using-npm/workspaces/"},"npm")," and ",(0,r.kt)("a",{parentName:"p",href:"https://pnpm.io/workspaces"},"pnpm")," workspaces and ",(0,r.kt)("a",{parentName:"p",href:"https://lerna.js.org/"},"Lerna"),"."),(0,r.kt)("h2",{id:"configuration"},"Configuration"),(0,r.kt)("p",null,"Configuring Codeshift in a monorepo can be done in the exact same way as ",(0,r.kt)("a",{parentName:"p",href:"/docs/authoring#2-add-codeshift-to-an-existing-package"},"any existing npm package"),", simply by adding ",(0,r.kt)("inlineCode",{parentName:"p"},"codeshift.config.js")," files and codemods to your packages."),(0,r.kt)("p",null,"Given you are using a workspace-based monorepo, it's recommended to co-locate codemods with your package source files so they can be published as part of the package, for use by both external and internal users."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-diff"},"packages/\n    button/\n+        codemods/\n+          1.0.0/\n+           transform.ts\n+           transform.spec.ts\n+          2.0.0/\n+          codeshift.config.js\n        src/\n            ...\n        package.json\n        rollup.config.json\n        jest.config.js\n    dialog/\n    modal/\n\npackage.json\n")),(0,r.kt)("p",null,"Codeshift config files can be located in either the root, ",(0,r.kt)("inlineCode",{parentName:"p"},"/src")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"/codemods")," directory of a package."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-diff"},"packages/\n    button/\n+        codemods/\n+          1.0.0/\n+          2.0.0/\n        src/\n            ...\n        package.json\n        rollup.config.json\n        jest.config.js\n+       codeshift.config.js\n    dialog/\n    modal/\n\npackage.json\n")),(0,r.kt)("p",null,"The structure or use of the ",(0,r.kt)("inlineCode",{parentName:"p"},"/codemods")," directory is entirely up to you. Codemods can be located anywhere in the package as long as the config file correctly\npoints to them."),(0,r.kt)("p",null,"See the ",(0,r.kt)("a",{parentName:"p",href:"/docs/configuration"},"configuration guide")," for help writing config files."),(0,r.kt)("h2",{id:"initializing"},"Initializing"),(0,r.kt)("p",null,"Codeshift provides a CLI to quickly codegen a working codemod package around your existing source files. To do so, run ",(0,r.kt)("inlineCode",{parentName:"p"},"init")," with the ",(0,r.kt)("inlineCode",{parentName:"p"},"--config-only")," flag,\nwhich will output a bare-bones configuration. If you provide a ",(0,r.kt)("inlineCode",{parentName:"p"},"--transform")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"--preset")," it will also generate empty transform files in addition."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"$ codeshift init --config-only --transform 10.0.0 --preset foobar packages/my-package")),(0,r.kt)("p",null,"(Note: this script assumes you have installed ",(0,r.kt)("inlineCode",{parentName:"p"},"@codeshift/cli")," globally)"),(0,r.kt)("p",null,"The output of this command will give you a filestructure matching the above example."),(0,r.kt)("h2",{id:"development"},"Development"),(0,r.kt)("p",null,"When writing codemod(s) it's recommended to use a ",(0,r.kt)("a",{parentName:"p",href:"/docs/testing"},"test-driven development approach")," before attempting to run on any real source code.\nOnce you're confident that your codemod works as expected, you will likely want to manually verify against real code.\nThat's where you can use the following command:"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"$ codeshift path/to/test/code"),"."),(0,r.kt)("p",null,"When used at the root directory of your monorepo, the CLI will leverage your workspaces config located in your ",(0,r.kt)("inlineCode",{parentName:"p"},"package.json")," to determine which codemods in the monorepo it can run."),(0,r.kt)("p",null,"ie:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "name": "monorepo",\n  "version": "1.0.0",\n  "workspaces": ["docs", "apps/*", "packages/*"]\n}\n')),(0,r.kt)("p",null,"And show an interactive list for you to search and can choose from."),(0,r.kt)("h2",{id:"publising"},"Publising"),(0,r.kt)("p",null,"The workflow to publishing your codemod enhanced packages should remain completely unchanged.\nHowever, it's important to verify that your ",(0,r.kt)("inlineCode",{parentName:"p"},"codeshift.config.js")," and codemods are not ignored by npm (via ",(0,r.kt)("inlineCode",{parentName:"p"},".npmignore")," or similar) so that they are successfully published to the registry."),(0,r.kt)("p",null,"In some cases you may need to add these to the ",(0,r.kt)("inlineCode",{parentName:"p"},"files")," property of your package's ",(0,r.kt)("inlineCode",{parentName:"p"},"package.json")," like so:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "name": "@monorepo/my-package",\n  "version": "0.6.0",\n  "main": "./dist/index.js",\n  "files": ["dist", "src", "codemods", "codeshift.config.js"]\n}\n')),(0,r.kt)("h2",{id:"running"},"Running"),(0,r.kt)("p",null,"Running a codemod as a consumer can now be done via the ",(0,r.kt)("inlineCode",{parentName:"p"},"@codemod/cli"),", assuming your package is named ",(0,r.kt)("inlineCode",{parentName:"p"},"@monorepo/my-package")," and your codemod is ",(0,r.kt)("inlineCode",{parentName:"p"},"1.0.0"),":"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"$ codeshift --packages @monorepo/my-package@1.0.0 /path/to/source")),(0,r.kt)("p",null,"You can even omit the codemod name to be prompted with all codemods as an interactive list:"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"$ codeshift --packages @monorepo/my-package /path/to/source")),(0,r.kt)("h2",{id:"examples"},"Examples"),(0,r.kt)("p",null,"Here are some helpful examples of this setup working in the wild:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/atlassian-labs/compiled/tree/master/packages/codemods"},"Compiled codemods")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/webdriverio/codemod"},"Webdriver.io codemods"))))}m.isMDXComponent=!0}}]);