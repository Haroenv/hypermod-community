"use strict";(self.webpackChunkcodeshift_community=self.webpackChunkcodeshift_community||[]).push([[2528],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return d}});var o=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=o.createContext({}),u=function(e){var t=o.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},c=function(e){var t=u(e.components);return o.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},m=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),m=u(n),d=r,f=m["".concat(l,".").concat(d)]||m[d]||p[d]||i;return n?o.createElement(f,a(a({ref:t},c),{},{components:n})):o.createElement(f,a({ref:t},c))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,a=new Array(i);a[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,a[1]=s;for(var u=2;u<i;u++)a[u]=n[u];return o.createElement.apply(null,a)}return o.createElement.apply(null,n)}m.displayName="MDXCreateElement"},9359:function(e,t,n){n.r(t),n.d(t,{assets:function(){return c},contentTitle:function(){return l},default:function(){return d},frontMatter:function(){return s},metadata:function(){return u},toc:function(){return p}});var o=n(3117),r=n(102),i=(n(7294),n(3905)),a=["components"],s={id:"testing",title:"Testing",slug:"/testing"},l=void 0,u={unversionedId:"testing",id:"testing",title:"Testing",description:"It's very likely that consumers will run into all sorts of edge-cases when running your codemod. That's why it's important to always start by writing tests (TDD style) to assert its behavior.",source:"@site/docs/testing.mdx",sourceDirName:".",slug:"/testing",permalink:"/docs/testing",editUrl:"https://github.com/CodeshiftCommunity/CodeshiftCommunity/edit/main/website/docs/testing.mdx",tags:[],version:"current",frontMatter:{id:"testing",title:"Testing",slug:"/testing"},sidebar:"docs",previous:{title:"Configuration",permalink:"/docs/configuration"},next:{title:"Motions",permalink:"/docs/motions"}},c={},p=[{value:"Folder structure",id:"folder-structure",level:2},{value:"An example",id:"an-example",level:2},{value:"Considerations",id:"considerations",level:2}],m={toc:p};function d(e){var t=e.components,n=(0,r.Z)(e,a);return(0,i.kt)("wrapper",(0,o.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"It's very likely that consumers will run into all sorts of edge-cases when running your codemod. That's why it's important to always start by writing tests (TDD style) to assert its behavior.\nThink about a start and end state. How you might be able to achieve that? What edge-cases can potentially arise?"),(0,i.kt)("p",null,"CodeshiftCommunity (and ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/facebook/jscodeshift#unit-testing"},"jscodeshift"),") exposes ",(0,i.kt)("a",{parentName:"p",href:"/docs/test-utils"},"testing utilities")," to help."),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Codemods are a textbook example of where TDD works. You have an input file, you run the script and you get output. Thus I would really recommend using TDD for codemod projects.\nNot only does it make codemods more stable, but having projects with test workflow setup, will help you learn.\nBecause you can experiment just by running the same test over and over again.")),(0,i.kt)("p",null,"\u2013 ",(0,i.kt)("a",{parentName:"p",href:"https://katilius.dev/writing-js-codemods/#setting-up-codemod-project-for-tdd-workflow"},"Reference")),(0,i.kt)("h2",{id:"folder-structure"},"Folder structure"),(0,i.kt)("p",null,"If you're planning to publish a codemod to ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/CodeshiftCommunity/CodeshiftCommunity/tree/main/community"},"the public registry"),", follow the ",(0,i.kt)("a",{parentName:"p",href:"/docs/authoring#initializing"},"Authoring guide"),"."),(0,i.kt)("p",null,"Once you've initialized, your file structure should look something like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"community/[package-name]/[version]\n  /transform.ts\n  /transform.spec.ts // Here's where your test should go\n")),(0,i.kt)("h2",{id:"an-example"},"An example"),(0,i.kt)("p",null,"To give an example, consider you're trying to write a codemod that removes deprecated props from a component.\nIn this case, you would be able to write a simple test using ",(0,i.kt)("inlineCode",{parentName:"p"},"jest")," & ",(0,i.kt)("inlineCode",{parentName:"p"},"@codeshift/test-utils")," like so.."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-jsx"},"import * as transformer from '../transform';\nimport { applyTransform } from '@codeshift/test-utils';\n\nit('should remove all deleted props', async () => {\n  const result = await applyTransform(\n    transformer,\n    `\n      import Foo from '@mylib/foo';\n\n      const App = () => <Foo isSelected doNotUse='true' />;\n    `,\n    { parser: 'tsx' },\n  );\n\n  expect(result).toMatchInlineSnapshot(`\n    \"\n    import Foo from '@mylib/foo';\n\n    const App = () => <Foo isSelected />;\"\n  `);\n});\n")),(0,i.kt)("p",null,"Great, but what have we missed? What might go wrong?"),(0,i.kt)("h2",{id:"considerations"},"Considerations"),(0,i.kt)("p",null,"Whenever you're writing tests for a codemod, it's usually good to consider a few classic gotchas."),(0,i.kt)("p",null,"In general they can include:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Import aliasing: ",(0,i.kt)("inlineCode",{parentName:"li"},"import { Foo as Bar } from '@mylib/foo';")),(0,i.kt)("li",{parentName:"ul"},"Idempotency: Will a codemod produce the same result if run multiple times on the same file"),(0,i.kt)("li",{parentName:"ul"},"Indirection: Is the code your modifying being obscured by indirection?"),(0,i.kt)("li",{parentName:"ul"},"Equivalent syntax: ",(0,i.kt)("inlineCode",{parentName:"li"},"function foo() {}")," vs ",(0,i.kt)("inlineCode",{parentName:"li"},"const foo = () => {}"))))}d.isMDXComponent=!0}}]);